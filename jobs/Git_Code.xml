<?xml version='1.1' encoding='UTF-8'?>
<flow-definition plugin="workflow-job@2.40">
  <actions/>
  <description>Clone Git Repositories - Select which repos to clone</description>
  <keepDependencies>false</keepDependencies>
  <properties>
    <hudson.model.ParametersDefinitionProperty>
      <parameterDefinitions>
        <hudson.model.BooleanParameterDefinition>
          <name>CLONE_APP</name>
          <description>Clone Application Repository (deploy_url_app)</description>
          <defaultValue>false</defaultValue>
        </hudson.model.BooleanParameterDefinition>
        <hudson.model.BooleanParameterDefinition>
          <name>CLONE_TERRAFORM</name>
          <description>Clone Terraform Infrastructure Repository (url_infra)</description>
          <defaultValue>false</defaultValue>
        </hudson.model.BooleanParameterDefinition>
        <hudson.model.BooleanParameterDefinition>
          <name>CLONE_MONITORING</name>
          <description>Clone Monitoring Stack Repository (monitoring_stack)</description>
          <defaultValue>false</defaultValue>
        </hudson.model.BooleanParameterDefinition>
      </parameterDefinitions>
    </hudson.model.ParametersDefinitionProperty>
  </properties>
  <definition class="org.jenkinsci.plugins.workflow.cps.CpsFlowDefinition" plugin="workflow-cps@2.90">
    <script><![CDATA[
pipeline {
  agent any
  
  stages {
    stage('Validate Selection') {
      steps {
        script {
          if (!params.CLONE_APP && !params.CLONE_TERRAFORM && !params.CLONE_MONITORING) {
            error('Please select at least one repository to clone')
          }
          echo "Selected repositories:"
          if (params.CLONE_APP) echo "  ✓ Application"
          if (params.CLONE_TERRAFORM) echo "  ✓ Terraform Infrastructure"
          if (params.CLONE_MONITORING) echo "  ✓ Monitoring Stack"
        }
      }
    }
    
    stage('Clone Application') {
      when {
        expression { params.CLONE_APP == true }
      }
      steps {
        echo "Cloning Application Repository..."
        sh "git clone https://github.com/inboxtoshashi/deploy_url_app.git || echo 'Already exists or failed'"
      }
    }
    
    stage('Clone Terraform Infrastructure') {
      when {
        expression { params.CLONE_TERRAFORM == true }
      }
      steps {
        echo "Cloning Terraform Infrastructure Repository..."
        sh "git clone https://github.com/inboxtoshashi/url_infra.git || echo 'Already exists or failed'"
      }
    }
    
    stage('Clone Monitoring Stack') {
      when {
        expression { params.CLONE_MONITORING == true }
      }
      steps {
        echo "Cloning Monitoring Stack Repository..."
        sh "git clone https://github.com/inboxtoshashi/monitoring_stack.git || echo 'Already exists or failed'"
      }
    }
    
    stage('Summary') {
      steps {
        script {
          echo "==================================="
          echo "Git Clone Summary:"
          if (params.CLONE_APP) {
            sh "ls -la deploy_url_app 2>/dev/null || echo '  ✗ Application clone failed'"
          }
          if (params.CLONE_TERRAFORM) {
            sh "ls -la url_infra 2>/dev/null || echo '  ✗ Terraform clone failed'"
          }
          if (params.CLONE_MONITORING) {
            sh "ls -la monitoring_stack 2>/dev/null || echo '  ✗ Monitoring clone failed'"
          }
          echo "==================================="
        }
      }
    }
  }
  
  post {
    success {
      echo "✅ Git clone operation completed successfully"
    }
    failure {
      echo "❌ Git clone operation failed"
    }
  }
}
    ]]></script>
    <sandbox>true</sandbox>
  </definition>
  <triggers/>
  <disabled>false</disabled>
</flow-definition>
